import m from'mithril';import{Product}from'../models/product.js';import{Cart}from'../models/cart.js';import{CONSTANTS}from'../utils/constants.js';import{Utils}from'../utils/helpers.js';import{Header}from'../components/Header.js';import{NotificationComponent}from'../components/Notification.js';import{Loading}from'../components/Loading.js';export const ProductDetail={oninit(v){if(Product.list().length===0)Product.loadAll()},view(v){const id=parseInt(v.attrs.id,10),p=Product.getById(id),l=Product.loading();if(l)return m('div',[m(Header),m('main.container',m(Loading))]);if(!p)return m('div',[m(Header),m('main.container',[m('div.error-message','Product not found'),m('a',{href:'#!/',oncreate:m.route.link},'← Back')])]);const o=p.stock===0,ls=p.stock<=CONSTANTS.LOW_STOCK_THRESHOLD&&p.stock>0;return m('div',[m(Header),m(NotificationComponent),m('main.container',[m('a.back-link',{href:'#!/',oncreate:m.route.link},'← Back to Products'),m('article.product-detail',[m('div',[m('img',{src:p.image,alt:p.name})]),m('div.product-info',[m('h1',p.name),m('div.price',Utils.formatPrice(p.price)),m('div.stock-info',{class:ls?'low-stock':''},o?'⚠️ Out of Stock':ls?`⚠️ Only ${p.stock} left!`:`✅ In Stock (${p.stock})`),m('p.description',p.description),m('div',[m('h3',{style:'margin-bottom:1rem'},'Features'),m('ul.features',p.features.map(f=>m('li',f)))]),m('div.product-actions',[m('button.add-to-cart-btn',{onclick:()=>Cart.add(p),disabled:o},o?'Out of Stock':'Add to Cart'),m('button.buy-now-btn',{onclick:()=>{if(Cart.add(p))m.route.set('/cart')},disabled:o},o?'Out of Stock':'Buy Now')])])])])])}};
